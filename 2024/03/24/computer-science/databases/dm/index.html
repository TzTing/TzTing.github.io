<!-- build time:Tue Apr 23 2024 00:46:46 GMT+0800 (GMT+08:00) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/tzblog/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/tzblog/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="一些记录" href="https://mytingting.gitee.io/tzblog/rss.xml"><link rel="alternate" type="application/atom+xml" title="一些记录" href="https://mytingting.gitee.io/tzblog/atom.xml"><link rel="alternate" type="application/json" title="一些记录" href="https://mytingting.gitee.io/tzblog/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/tzblog/css/app.css?v=0.2.5"><meta name="keywords" content="达梦"><link rel="canonical" href="https://mytingting.gitee.io/tzblog/2024/03/24/computer-science/databases/dm/"><title>达梦数据库 - 数据库 - 计算机科学 | Tz = 一些记录 = = 编程、羽毛球、游戏、骑行 =</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">达梦数据库</h1><div class="meta"><span class="item" title="创建时间：2024-03-24 19:12:45"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-03-24T19:12:45+08:00">2024-03-24</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>11k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>10 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/tzblog/" rel="start">Tz</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tzting.github.io/images/sky3.jpg"></li><li class="item" data-background-image="https://tzting.github.io/images/sky4.jpg"></li><li class="item" data-background-image="https://tzting.github.io/images/sky8.jpg"></li><li class="item" data-background-image="https://tzting.github.io/images/sky7.jpg"></li><li class="item" data-background-image="https://tzting.github.io/images/sky9.jpg"></li><li class="item" data-background-image="https://tzting.github.io/images/sky5.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/tzblog/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/tzblog/categories/computer-science/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/tzblog/categories/computer-science/databases/" itemprop="item" rel="index" title="分类于 数据库"><span itemprop="name">数据库</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://mytingting.gitee.io/tzblog/2024/03/24/computer-science/databases/dm/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/tzblog/images/avatar.jpg"><meta itemprop="name" content="Tz"><meta itemprop="description" content="= 编程、羽毛球、游戏、骑行 =, 君将自由, 我心亦然"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="一些记录"></span><div class="body md" itemprop="articleBody"><div class="note info"><p>可根据关键字搜索：内存，性能，元数据信息</p></div><h1 id="达梦数据库"><a class="anchor" href="#达梦数据库">#</a> 达梦数据库</h1><h2 id="介绍"><a class="anchor" href="#介绍">#</a> 介绍</h2><p>达梦数据库管理系统（DM）是一款功能强大的关系型数据库管理系统，提供了丰富的功能和工具，使得数据管理变得更加高效和便捷。本文将介绍如何使用达梦数据库进行数据管理的基本步骤。</p><h2 id="达梦数据库常用命令"><a class="anchor" href="#达梦数据库常用命令">#</a> 达梦数据库常用命令</h2><ol><li>查看达梦数据库配置文件的相关参数</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$dm_ini</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">-- 其中 para_type 类型的值有：</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">READ</span> ONLY  只读，不能修改</pre></td></tr><tr><td data-num="5"></td><td><pre>SYS        系统级别，可以修改全局生效</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">IN</span> <span class="token keyword">FILE</span>    只能在配置文件中修改</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">SESSION</span>    会话级别</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>只有<span class="token keyword">session</span> 和 sys 类型可以在线更改， 其他类型更改需要重启</pre></td></tr></table></figure><ol start="2"><li>在线修改 dm_ini 内容</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#修改系统级别的参数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">alter</span> system <span class="token keyword">set</span> <span class="token string">'MEMORY_LEAK_CHECK'</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>或者</pre></td></tr><tr><td data-num="4"></td><td><pre>SP_SET_PARA_VALUE<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'MEMORY_LEAK_CHECK'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#修改会话级别的参数</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">alter</span> <span class="token keyword">session</span> <span class="token keyword">set</span> <span class="token string">'MONITOR_SQL_EXEC'</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>或者</pre></td></tr><tr><td data-num="9"></td><td><pre>SF_SET_SESSION_PARA_VALUE<span class="token punctuation">(</span><span class="token string">'MONITOR_SQL_EXEC'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">-- 动态打开会话级参数 MONITOR_SQL_EXEC，该设置只对本会话有效，其余会话无影响</span></pre></td></tr></table></figure><ol start="3"><li>查询会话数和会话信息</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 查询会话信息</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">select</span>  A<span class="token punctuation">.</span>SESS_ID<span class="token punctuation">,</span>A<span class="token punctuation">.</span>SQL_TEXT<span class="token punctuation">,</span>A<span class="token punctuation">.</span>STATE<span class="token punctuation">,</span>A<span class="token punctuation">.</span>N_USED_STMT<span class="token punctuation">,</span>A<span class="token punctuation">.</span>CURR_SCH<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>A<span class="token punctuation">.</span>USER_NAME<span class="token punctuation">,</span>A<span class="token punctuation">.</span>TRX_ID<span class="token punctuation">,</span>A<span class="token punctuation">.</span>CREATE_TIME<span class="token punctuation">,</span>A<span class="token punctuation">.</span>CLNT_TYPE<span class="token punctuation">,</span>A<span class="token punctuation">.</span>TIME_ZONE<span class="token punctuation">,</span>A<span class="token punctuation">.</span>OSNAME<span class="token punctuation">,</span>A<span class="token punctuation">.</span>CONN_TYPE<span class="token punctuation">,</span> B<span class="token punctuation">.</span>PROTOCOL_TYPE<span class="token punctuation">,</span>B<span class="token punctuation">.</span>IP_ADDR <span class="token keyword">FROM</span>  SYS<span class="token punctuation">.</span>V$SESSIONS A<span class="token punctuation">,</span>SYS<span class="token punctuation">.</span>V$<span class="token keyword">CONNECT</span> B <span class="token keyword">where</span>  A<span class="token punctuation">.</span>Sess_id<span class="token operator">=</span> B<span class="token punctuation">.</span>SADDR <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SF_GET_EP_SEQNO<span class="token punctuation">(</span>A<span class="token punctuation">.</span>rowid<span class="token punctuation">)</span><span class="token punctuation">,</span>A<span class="token punctuation">.</span>Sess_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 或者</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">select</span>  SF_GET_SESSION_SQL<span class="token punctuation">(</span>ASESS_ID<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">-- 获取完整 sql</span></pre></td></tr><tr><td data-num="6"></td><td><pre>A<span class="token punctuation">.</span>SQL_TEXT<span class="token punctuation">,</span>A<span class="token punctuation">.</span>STATE<span class="token punctuation">,</span>A<span class="token punctuation">.</span>N_USED_STMT<span class="token punctuation">,</span>A<span class="token punctuation">.</span>CURR_SCH<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>A<span class="token punctuation">.</span>USER_NAME<span class="token punctuation">,</span>A<span class="token punctuation">.</span>TRX_ID<span class="token punctuation">,</span>A<span class="token punctuation">.</span>CREATE_TIME<span class="token punctuation">,</span>A<span class="token punctuation">.</span>CLNT_TYPE<span class="token punctuation">,</span>A<span class="token punctuation">.</span>TIME_ZONE<span class="token punctuation">,</span>A<span class="token punctuation">.</span>OSNAME<span class="token punctuation">,</span>A<span class="token punctuation">.</span>CONN_TYPE<span class="token punctuation">,</span> B<span class="token punctuation">.</span>PROTOCOL_TYPE<span class="token punctuation">,</span>B<span class="token punctuation">.</span>IP_ADDR <span class="token keyword">FROM</span>  SYS<span class="token punctuation">.</span>V$SESSIONS A<span class="token punctuation">,</span>SYS<span class="token punctuation">.</span>V$<span class="token keyword">CONNECT</span> B <span class="token keyword">where</span>  A<span class="token punctuation">.</span>Sess_id<span class="token operator">=</span> B<span class="token punctuation">.</span>SADDR <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> SF_GET_EP_SEQNO<span class="token punctuation">(</span>A<span class="token punctuation">.</span>rowid<span class="token punctuation">)</span><span class="token punctuation">,</span>A<span class="token punctuation">.</span>Sess_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">-- 会话中执行超过指定时间的语句</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">-- 查询执行效率慢的 sql</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num="12"></td><td><pre>sess_id<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>sql_text<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>datediff <span class="token punctuation">(</span>ss<span class="token punctuation">,</span> last_recv_time<span class="token punctuation">,</span> SYSDATE<span class="token punctuation">)</span> Y_EXETIME<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>SF_GET_SESSION_SQL <span class="token punctuation">(</span>SESS_ID<span class="token punctuation">)</span> fullsql<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>clnt_ip</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">FROM</span> V$SESSIONS <span class="token keyword">WHERE</span> STATE <span class="token operator">=</span> <span class="token string">'ACTIVE'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">WHERE</span></pre></td></tr><tr><td data-num="19"></td><td><pre>Y_EXETIME <span class="token operator">>=</span> <span class="token number">2</span><span class="token punctuation">;</span>   <span class="token comment">-- 执行时间超 2s，可以自定义该时间</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">-- 查询当前所有会话数</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> v$sessions<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">-- 查看当前数据库中活动会话</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> v$sessions <span class="token keyword">where</span> state<span class="token operator">=</span><span class="token string">'ACTIVE'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">-- 查看当前非活动会话</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">from</span> v$sessions <span class="token keyword">where</span> state<span class="token operator">=</span><span class="token string">'IDLE'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">-- 结束会话</span></pre></td></tr><tr><td data-num="28"></td><td><pre>sp_close_session<span class="token punctuation">(</span>sess_id<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="4"><li>慢 sql 和阻塞监控</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        DS<span class="token punctuation">.</span>SESS_ID <span class="token string">"被阻塞的会话ID"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        DS<span class="token punctuation">.</span>SQL_TEXT <span class="token string">"被阻塞的SQL"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        DS<span class="token punctuation">.</span>TRX_ID <span class="token string">"被阻塞的事务ID"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">(</span><span class="token keyword">CASE</span> L<span class="token punctuation">.</span>LTYPE <span class="token keyword">WHEN</span> <span class="token string">'OBJECT'</span> <span class="token keyword">THEN</span> <span class="token string">'对象锁'</span> <span class="token keyword">WHEN</span> <span class="token string">'TID'</span> <span class="token keyword">THEN</span> <span class="token string">'事务锁'</span> <span class="token keyword">END</span> <span class="token keyword">CASE</span> <span class="token punctuation">)</span> <span class="token string">"被阻塞的锁类型"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        DS<span class="token punctuation">.</span>CREATE_TIME <span class="token string">"开始阻塞时间"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        SS<span class="token punctuation">.</span>SESS_ID <span class="token string">"占用锁的会话ID"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        SS<span class="token punctuation">.</span>SQL_TEXT <span class="token string">"占用锁的SQL"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        SS<span class="token punctuation">.</span>CLNT_IP <span class="token string">"占用锁的IP"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        L<span class="token punctuation">.</span>TID <span class="token string">"占用锁的事务ID"</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">FROM</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        V$<span class="token keyword">LOCK</span> L</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> V$SESSIONS DS</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">ON</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        DS<span class="token punctuation">.</span>TRX_ID <span class="token operator">=</span> L<span class="token punctuation">.</span>TRX_ID</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> V$SESSIONS SS</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">ON</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        SS<span class="token punctuation">.</span>TRX_ID <span class="token operator">=</span> L<span class="token punctuation">.</span>TID</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">WHERE</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        L<span class="token punctuation">.</span>BLOCKED <span class="token operator">=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        </pre></td></tr><tr><td data-num="22"></td><td><pre>上述 <span class="token keyword">SQL</span> 语句中，“占用锁的会话 ID ”表示该会话占用这个对象的锁，且事务一直没有提交。导致“被阻塞的会话 ID ”无法对该对象上锁。可以参考以下解决方式：</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>方式一：杀掉占用锁的会话，释放锁。</pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>SP_CLOSE_SESSION <span class="token punctuation">(</span> 占用锁的会话 ID <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>方式二：杀掉被阻塞的会话。</pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>SP_CLOSE_SESSION <span class="token punctuation">(</span> 被阻塞的会话 ID <span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre>        </pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token comment">-- 或者下面的阻塞语句</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">WITH</span> LOCKS</pre></td></tr><tr><td data-num="36"></td><td><pre>     <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> O<span class="token punctuation">.</span>NAME<span class="token punctuation">,</span>L<span class="token punctuation">.</span><span class="token operator">*</span><span class="token punctuation">,</span>S<span class="token punctuation">.</span>SESS_ID<span class="token punctuation">,</span>S<span class="token punctuation">.</span>SQL_TEXT<span class="token punctuation">,</span>S<span class="token punctuation">.</span>CLNT_IP<span class="token punctuation">,</span>S<span class="token punctuation">.</span>LAST_SEND_TIME</pre></td></tr><tr><td data-num="37"></td><td><pre>           <span class="token keyword">FROM</span> V$<span class="token keyword">LOCK</span> L<span class="token punctuation">,</span> SYSOBJECTS O<span class="token punctuation">,</span> V$SESSIONS S</pre></td></tr><tr><td data-num="38"></td><td><pre>          <span class="token keyword">WHERE</span> L<span class="token punctuation">.</span>TABLE_ID <span class="token operator">=</span> O<span class="token punctuation">.</span>ID <span class="token operator">AND</span> L<span class="token punctuation">.</span>TRX_ID <span class="token operator">=</span> S<span class="token punctuation">.</span>TRX_ID<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>     LOCK_TR</pre></td></tr><tr><td data-num="40"></td><td><pre>     <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> TRX_ID WT_TRXID<span class="token punctuation">,</span> TID BLK_TRXID</pre></td></tr><tr><td data-num="41"></td><td><pre>           <span class="token keyword">FROM</span> LOCKS</pre></td></tr><tr><td data-num="42"></td><td><pre>          <span class="token keyword">WHERE</span> BLOCKED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>     RES</pre></td></tr><tr><td data-num="44"></td><td><pre>     <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">SELECT</span> SYSDATE STATTIME<span class="token punctuation">,</span>T1<span class="token punctuation">.</span>NAME<span class="token punctuation">,</span>T1<span class="token punctuation">.</span>SESS_ID WT_SESSID<span class="token punctuation">,</span>S<span class="token punctuation">.</span>WT_TRXID<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                T2<span class="token punctuation">.</span>SESS_ID BLK_SESSID<span class="token punctuation">,</span>S<span class="token punctuation">.</span>BLK_TRXID<span class="token punctuation">,</span>T2<span class="token punctuation">.</span>CLNT_IP<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                SF_GET_SESSION_SQL <span class="token punctuation">(</span>T1<span class="token punctuation">.</span>SESS_ID<span class="token punctuation">)</span> FULSQL<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                DATEDIFF <span class="token punctuation">(</span>SS<span class="token punctuation">,</span> T1<span class="token punctuation">.</span>LAST_SEND_TIME<span class="token punctuation">,</span> SYSDATE<span class="token punctuation">)</span> SS<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                T1<span class="token punctuation">.</span>SQL_TEXT WT_SQL</pre></td></tr><tr><td data-num="49"></td><td><pre>           <span class="token keyword">FROM</span> LOCK_TR S<span class="token punctuation">,</span> LOCKS T1<span class="token punctuation">,</span> LOCKS T2</pre></td></tr><tr><td data-num="50"></td><td><pre>          <span class="token keyword">WHERE</span>     T1<span class="token punctuation">.</span>LTYPE <span class="token operator">=</span> <span class="token string">'OBJECT'</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token operator">AND</span> T1<span class="token punctuation">.</span>TABLE_ID <span class="token operator">&lt;></span> <span class="token number">0</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token operator">AND</span> T2<span class="token punctuation">.</span>LTYPE <span class="token operator">=</span> <span class="token string">'OBJECT'</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                <span class="token operator">AND</span> T2<span class="token punctuation">.</span>TABLE_ID <span class="token operator">&lt;></span> <span class="token number">0</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token operator">AND</span> S<span class="token punctuation">.</span>WT_TRXID <span class="token operator">=</span> T1<span class="token punctuation">.</span>TRX_ID</pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token operator">AND</span> S<span class="token punctuation">.</span>BLK_TRXID <span class="token operator">=</span> T2<span class="token punctuation">.</span>TRX_ID<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> WT_SQL<span class="token punctuation">,</span>CLNT_IP<span class="token punctuation">,</span>SS<span class="token punctuation">,</span>WT_TRXID<span class="token punctuation">,</span>BLK_TRXID</pre></td></tr><tr><td data-num="57"></td><td><pre>  <span class="token keyword">FROM</span> RES<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="5"><li>查询死锁历史事务信息 （性能）</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        dh<span class="token punctuation">.</span>trx_id <span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        sh<span class="token punctuation">.</span>sess_id<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        wm_concat<span class="token punctuation">(</span>top_sql_text<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        V$DEADLOCK_HISTORY dh<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        V$SQL_HISTORY sh</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">where</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        dh<span class="token punctuation">.</span>trx_id <span class="token operator">=</span>sh<span class="token punctuation">.</span>trx_id</pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token operator">and</span> dh<span class="token punctuation">.</span>sess_id<span class="token operator">=</span>sh<span class="token punctuation">.</span>sess_id</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">group</span> <span class="token keyword">by</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        dh<span class="token punctuation">.</span>trx_id<span class="token punctuation">,</span> sh<span class="token punctuation">.</span>sess_id<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="6"><li>有事务未提交的表查询</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> b<span class="token punctuation">.</span>object_name<span class="token punctuation">,</span> c<span class="token punctuation">.</span>sess_id<span class="token punctuation">,</span> a<span class="token punctuation">.</span><span class="token operator">*</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">FROM</span> v$<span class="token keyword">lock</span> a<span class="token punctuation">,</span> dba_objects b<span class="token punctuation">,</span> v$sessions c</pre></td></tr><tr><td data-num="3"></td><td><pre> <span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>table_id <span class="token operator">=</span> b<span class="token punctuation">.</span>object_id <span class="token operator">AND</span> ltype <span class="token operator">=</span> <span class="token string">'OBJECT'</span> <span class="token operator">AND</span> a<span class="token punctuation">.</span>trx_id <span class="token operator">=</span> c<span class="token punctuation">.</span>trx_id<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="7"><li>内存监控</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>n_pages <span class="token operator">*</span> page_size<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> v$bufferpool</pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token operator">||</span><span class="token string">'MB'</span> <span class="token keyword">as</span> BUFFER_SIZE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>total_size<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> v$mem_pool</pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token operator">||</span><span class="token string">'MB'</span> <span class="token keyword">as</span> mem_pool<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>n_pages <span class="token operator">*</span> page_size<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> v$bufferpool</pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token operator">+</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                <span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>total_size<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> v$mem_pool</pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token operator">||</span><span class="token string">'MB'</span> <span class="token keyword">as</span> TOTAL_SIZE</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">from</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        dual<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        </pre></td></tr><tr><td data-num="21"></td><td><pre>以上查询结果中，字段含义如下：</pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token number">1.</span> BUFFER_SIZE：系统缓冲区大小，以 M 为单位。推荐值：系统缓冲区大小为可用物理内存的 <span class="token number">60</span><span class="token operator">%</span>～<span class="token number">80</span><span class="token operator">%</span>。有效值范围（<span class="token number">8</span><span class="token operator">~</span><span class="token number">1048576</span>）</pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token number">2.</span> MEM_POOL：共享内存池大小，以 M 为单位。共享内存池是由 DM 管理的内存。有效值范围：<span class="token number">32</span> 位平台为（<span class="token number">642000</span>），<span class="token number">64</span> 位平台为（<span class="token number">6467108864</span>）</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token number">3.</span> TOTAL_SIZE：BUFFER_SIZE 和 MEM_POOL 的总和。</pre></td></tr><tr><td data-num="25"></td><td><pre>内存不足常见原因有如下两种情况：</pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token number">1.</span> memory_target 设置为 <span class="token number">0</span>，导致会话使用的内存未释放，可以考虑修改 memory_target 参数。</pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token number">2.</span> 会话执行的 <span class="token keyword">sql</span> 消耗大量的内存，可以根据以下 <span class="token keyword">sql</span> 找到最占用内存的 <span class="token keyword">sql</span>，再进行 <span class="token keyword">sql</span> 优化。</pre></td></tr><tr><td data-num="28"></td><td><pre>    </pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">SELECT</span> <span class="token string">"SESSID"</span><span class="token punctuation">,</span> MAX_MEM_USED<span class="token operator">||</span><span class="token string">'KB'</span><span class="token punctuation">,</span>SQL_TXT <span class="token keyword">FROM</span> V$SQL_STAT </pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">order</span> <span class="token keyword">by</span> MAX_MEM_USED <span class="token keyword">DESC</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="8"><li>内存池使用情况</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span>  name <span class="token punctuation">,</span>stat_val<span class="token operator">/</span><span class="token number">1024.0</span><span class="token operator">/</span><span class="token number">1024.0</span> <span class="token keyword">from</span>  v$sysstat <span class="token keyword">where</span> CLASSID <span class="token operator">=</span> <span class="token number">11</span> <span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="9"><li>单个会话的内存使用情况</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span></pre></td></tr><tr><td data-num="2"></td><td><pre>        A<span class="token punctuation">.</span>CREATOR                          <span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        B<span class="token punctuation">.</span>SQL_TEXT                         <span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token function">SUM</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span>TOTAL_SIZE<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024.0</span><span class="token operator">/</span><span class="token number">1024.0</span> TOTAL_M<span class="token punctuation">,</span>    <span class="token comment">-- 当前总量 (包括扩展)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token function">SUM</span><span class="token punctuation">(</span>A<span class="token punctuation">.</span>DATA_SIZE<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token number">1024.0</span><span class="token operator">/</span><span class="token number">1024.0</span> DATA_SIZE_M  <span class="token comment">-- 实际使用量</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">FROM</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        V$MEM_POOL A<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        V$SESSIONS B</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">WHERE</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        A<span class="token punctuation">.</span>CREATOR <span class="token operator">=</span> B<span class="token punctuation">.</span>THRD_ID</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">GROUP</span> <span class="token keyword">BY</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        A<span class="token punctuation">.</span>CREATOR<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        B<span class="token punctuation">.</span>SQL_TEXT</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">ORDER</span> <span class="token keyword">BY</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        TOTAL_M <span class="token keyword">DESC</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="10"><li>内存增长过快分析（性能，内存）</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>n_pages <span class="token operator">*</span> page_size<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> v$bufferpool<span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">'MB'</span> <span class="token keyword">as</span> BUFFER_SIZE<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>total_size<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> v$mem_pool<span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">'MB'</span> <span class="token keyword">as</span> mem_pool<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>n_pages <span class="token operator">*</span> page_size<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> v$bufferpool<span class="token punctuation">)</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">select</span> <span class="token function">sum</span><span class="token punctuation">(</span>total_size<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">1024</span><span class="token operator">/</span><span class="token number">1024</span> <span class="token keyword">from</span> v$mem_pool<span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">'MB'</span> <span class="token keyword">as</span> TOTAL_SIZE</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">from</span>  dual<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>在启动前查询上述语句，记录初始值。然后在内存增长的时候，再查询上述语句。</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>（<span class="token number">2</span>）打开 MEMORY_LEAK_CHECK</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">alter</span> system <span class="token keyword">set</span> <span class="token string">'MEMORY_LEAK_CHECK'</span><span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>（<span class="token number">3</span>）查询 V$MEM_REGINFO 视图，关注 REFNUM 字段，若该字段值很大，则说明存在内存堆积的情况。</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> V$MEM_REGINFO <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> REFNUM <span class="token keyword">DESC</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="11"><li>表空间使用情况（元数据信息）</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> Upper<span class="token punctuation">(</span>F<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">)</span>         <span class="token string">"表空间名"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>       D<span class="token punctuation">.</span>TOT_GROOTTE_MB                 <span class="token string">"表空间大小(M)"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>       D<span class="token punctuation">.</span>TOT_GROOTTE_MB <span class="token operator">-</span> F<span class="token punctuation">.</span>TOTAL_BYTES <span class="token string">"已使用空间(M)"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>       To_char<span class="token punctuation">(</span><span class="token function">Round</span><span class="token punctuation">(</span><span class="token punctuation">(</span> D<span class="token punctuation">.</span>TOT_GROOTTE_MB <span class="token operator">-</span> F<span class="token punctuation">.</span>TOTAL_BYTES <span class="token punctuation">)</span> <span class="token operator">/</span> D<span class="token punctuation">.</span>TOT_GROOTTE_MB <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'990.99'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>       <span class="token operator">||</span> <span class="token string">'%'</span>                           <span class="token string">"使用比"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>       F<span class="token punctuation">.</span>TOTAL_BYTES                    <span class="token string">"空闲空间(M)"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>       F<span class="token punctuation">.</span>MAX_BYTES                      <span class="token string">"最大块(M)"</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">FROM</span>   <span class="token punctuation">(</span><span class="token keyword">SELECT</span> TABLESPACE_NAME<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>               <span class="token function">Round</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> TOTAL_BYTES<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>               <span class="token function">Round</span><span class="token punctuation">(</span><span class="token function">Max</span><span class="token punctuation">(</span>BYTES<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> MAX_BYTES</pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">FROM</span>   SYS<span class="token punctuation">.</span>DBA_FREE_SPACE</pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token keyword">GROUP</span>  <span class="token keyword">BY</span> TABLESPACE_NAME<span class="token punctuation">)</span> F<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>       <span class="token punctuation">(</span><span class="token keyword">SELECT</span> DD<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>               <span class="token function">Round</span><span class="token punctuation">(</span><span class="token function">Sum</span><span class="token punctuation">(</span>DD<span class="token punctuation">.</span>BYTES<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> TOT_GROOTTE_MB</pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">FROM</span>   SYS<span class="token punctuation">.</span>DBA_DATA_FILES DD</pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">GROUP</span>  <span class="token keyword">BY</span> DD<span class="token punctuation">.</span>TABLESPACE_NAME<span class="token punctuation">)</span> D</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token keyword">WHERE</span>  D<span class="token punctuation">.</span>TABLESPACE_NAME <span class="token operator">=</span> F<span class="token punctuation">.</span>TABLESPACE_NAME</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">ORDER</span>  <span class="token keyword">BY</span> <span class="token number">2</span> <span class="token keyword">desc</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">-- 临时表空间经常过大，说明内存设置过小或存在大量中间结果集存放，需要视情况进行优化。</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">-- 为了不影响磁盘空间的使用，可以通过 ini 参数 TEMP_SIZE 配置大小、TEMP_SPACE_LIMIT 设置上限、存储过程 SP_TRUNC_TS_FILE 来收缩 TEMP 表空间文件（生产环境请谨慎使用）。</span></pre></td></tr></table></figure><ol start="11"><li>查看表空间与数据文件的关系</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> TS<span class="token punctuation">.</span>NAME<span class="token punctuation">,</span> DF<span class="token punctuation">.</span>PATH <span class="token keyword">FROM</span> V$<span class="token keyword">TABLESPACE</span> <span class="token keyword">AS</span> TS<span class="token punctuation">,</span> V$DATAFILE <span class="token keyword">AS</span> DF <span class="token keyword">WHERE</span> TS<span class="token punctuation">.</span>ID <span class="token operator">=</span> DF<span class="token punctuation">.</span>GROUP_ID<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="12"><li>查询表索引是否可用</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span> I<span class="token punctuation">.</span>TABLE_OWNER<span class="token punctuation">,</span>I<span class="token punctuation">.</span>TABLE_NAME<span class="token punctuation">,</span>O<span class="token punctuation">.</span>OBJECT_NAME<span class="token punctuation">,</span>O<span class="token punctuation">.</span>OBJECT_TYPE<span class="token punctuation">,</span>O<span class="token punctuation">.</span><span class="token keyword">STATUS</span> <span class="token keyword">FROM</span> USER_INDEXES I<span class="token punctuation">,</span>USER_OBJECTS O <span class="token keyword">WHERE</span> O<span class="token punctuation">.</span>OBJECT_NAME<span class="token operator">=</span>I<span class="token punctuation">.</span>INDEX_NAME <span class="token operator">AND</span> O<span class="token punctuation">.</span><span class="token keyword">STATUS</span><span class="token operator">=</span><span class="token string">'INVALID'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="13"><li>查询等待事件的具体信息</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span> THREAD_ID<span class="token punctuation">,</span>TRX_ID<span class="token punctuation">,</span>WAIT_CLASS<span class="token punctuation">,</span>WAIT_OBJECT<span class="token punctuation">,</span>WAIT_START<span class="token punctuation">,</span>WAIT_TIME<span class="token punctuation">,</span> SPACE_ID<span class="token punctuation">,</span>FILE_ID<span class="token punctuation">,</span>PAGE_NO <span class="token keyword">FROM</span> V$WAIT_HISTORY<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="14"><li>层次查询，根据指定的上下级关系字段</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="2"></td><td><pre>                  employee_name<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>                  job_title<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>                  manager_id<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                  department_id<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                  <span class="token keyword">LEVEL</span></pre></td></tr><tr><td data-num="7"></td><td><pre>             <span class="token keyword">FROM</span> dmhr<span class="token punctuation">.</span>emp</pre></td></tr><tr><td data-num="8"></td><td><pre>       <span class="token keyword">START</span> <span class="token keyword">WITH</span> employee_id <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="9"></td><td><pre>       <span class="token keyword">CONNECT</span> <span class="token keyword">BY</span> PRIOR employee_id <span class="token operator">=</span> manager_id</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">ORDER</span> SIBLINGS <span class="token keyword">BY</span> employee_id<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">100</span>	Steven<span class="token punctuation">,</span> King	President	<span class="token boolean">NULL</span>	<span class="token number">90</span>	<span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token number">101</span>	Neena<span class="token punctuation">,</span> Kochhar	Administration Vice President	<span class="token number">100</span>	<span class="token number">90</span>	<span class="token number">2</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">108</span>	Nancy<span class="token punctuation">,</span> Greenberg	Finance Manager	<span class="token number">101</span>	<span class="token number">100</span>	<span class="token number">3</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token number">109</span>	Daniel<span class="token punctuation">,</span> Faviet	Accountant	<span class="token number">108</span>	<span class="token number">100</span>	<span class="token number">4</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">110</span>	John<span class="token punctuation">,</span> Chen	Accountant	<span class="token number">108</span>	<span class="token number">100</span>	<span class="token number">4</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">111</span>	Ismael<span class="token punctuation">,</span> Sciarra	Accountant	<span class="token number">108</span>	<span class="token number">100</span>	<span class="token number">4</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">112</span>	Jose Manuel<span class="token punctuation">,</span> Urman	Accountant	<span class="token number">108</span>	<span class="token number">100</span>	<span class="token number">4</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">113</span>	Luis<span class="token punctuation">,</span> Popp	Accountant	<span class="token number">108</span>	<span class="token number">100</span>	<span class="token number">4</span></pre></td></tr></table></figure><ol start="15"><li>在应用中发现执行较慢的 SQL，在管理工具中执行很快</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>可通过查看系统视图，及时发现活动会话中的慢 <span class="token keyword">SQL</span>，将其在计划缓存中的执行计划打印到 trc 文件中，核查是否与在管理工具中查询到的执行计划一致，偏差较大则清理缓存中执行计划。</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>具体方法如下：</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>通过 PLNDUMP 来看对应缓存中的 <span class="token keyword">SQL</span> 执行计划</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    查找出活动会话中执行时间大于 <span class="token number">1</span>S 的 <span class="token keyword">SQL</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">select</span> timestampdiff<span class="token punctuation">(</span><span class="token keyword">second</span><span class="token punctuation">,</span>s<span class="token punctuation">.</span>last_recv_time<span class="token punctuation">,</span>sysdate<span class="token punctuation">)</span> t <span class="token punctuation">,</span>s<span class="token punctuation">.</span><span class="token operator">*</span> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">from</span> v$sessions s  <span class="token keyword">where</span> state<span class="token operator">=</span><span class="token string">'ACTIVE'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">where</span> t <span class="token operator">></span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>    找到对应慢 <span class="token keyword">SQL</span> 对应的 cache_item 值。</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$cachepln <span class="token keyword">where</span> upper<span class="token punctuation">(</span>sqlstr<span class="token punctuation">)</span> <span class="token operator">like</span> <span class="token string">'%SQL%'</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    在 trace 目录中生成对应 trc 文件</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">alter</span> <span class="token keyword">session</span> <span class="token keyword">set</span> events <span class="token string">'immediate trace name plndump ,level cache_item'</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>    对比管理工具的执行计划和 <span class="token punctuation">.</span>trc 文件中的执行计划。</pre></td></tr><tr><td data-num="26"></td><td><pre>    清理内存中执行计划缓存。</pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">call</span> sp_clear_plan_cache<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token keyword">call</span> sp_clear_plan_cache<span class="token punctuation">(</span>pln号<span class="token punctuation">)</span>；<span class="token comment">--- 不加 pln 就是清理所有 sql 缓存。</span></pre></td></tr></table></figure><ol start="16"><li>看某条 sql 语句每个操作符的执行时间</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>SF_SET_SESSION_PARA_VALUE<span class="token punctuation">(</span><span class="token string">'MONITOR_SQL_EXEC'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">-- 动态打开会话级参数 MONITOR_SQL_EXEC，该设置只对本会话有效，其余会话无影响</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 查询语句</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tablename</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">-- 可以在消息栏看到：</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>执行语句<span class="token number">1</span><span class="token punctuation">]</span>:</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tablename</pre></td></tr><tr><td data-num="10"></td><td><pre>执行成功<span class="token punctuation">,</span> 执行耗时<span class="token number">84</span>毫秒<span class="token punctuation">.</span> 执行号:<span class="token number">97812</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">-- 点击执行号可以看到操作符的执行时间</span></pre></td></tr><tr><td data-num="12"></td><td><pre>DLCK	<span class="token number">1</span>	<span class="token number">0.74</span><span class="token operator">%</span>	<span class="token number">5</span>	<span class="token number">0</span>	<span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">0</span></pre></td></tr><tr><td data-num="13"></td><td><pre>PRJT2	<span class="token number">3</span>	<span class="token number">2.22</span><span class="token operator">%</span>	<span class="token number">4</span>	<span class="token number">2</span>	<span class="token number">4</span>	<span class="token number">0</span>	<span class="token number">0</span></pre></td></tr><tr><td data-num="14"></td><td><pre>TOPN2	<span class="token number">11</span>	<span class="token number">8.15</span><span class="token operator">%</span>	<span class="token number">3</span>	<span class="token number">3</span>	<span class="token number">4</span>	<span class="token number">0</span>	<span class="token number">0</span></pre></td></tr><tr><td data-num="15"></td><td><pre>NSET2	<span class="token number">50</span>	<span class="token number">37.04</span><span class="token operator">%</span>	<span class="token number">2</span>	<span class="token number">1</span>	<span class="token number">3</span>	<span class="token number">0</span>	<span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre>CSCN2	<span class="token number">70</span>	<span class="token number">51.85</span><span class="token operator">%</span>	<span class="token number">1</span>	<span class="token number">4</span>	<span class="token number">2</span>	<span class="token number">0</span>	<span class="token number">0</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>如上图所示，该 <span class="token keyword">sql</span> 语句共涉及 <span class="token number">5</span> 个操作符，按照执行的先后顺序分别是 CSCN2、NSET2、TOPN2、PRJT2、DLCK。</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>其中，耗时最长的操作符是 CSCN2，耗时 <span class="token number">70</span> 微秒，占总执行时间的 <span class="token number">51.85</span><span class="token operator">%</span>；耗时排第二位的操作符是 NSET2，耗时 <span class="token number">50</span> 微秒，占总执行时间的 <span class="token number">37.04</span><span class="token operator">%</span>。</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>根据上述的分析，我们就需要针对这 <span class="token number">2</span> 个操作符进行针对性的优化。</pre></td></tr></table></figure><ol start="17"><li>大量的 DML 动作 (经常做增删改查) 导致表的碎片很多，最终导致查询该表性能很慢，如何解决（性能）</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>达梦的数据通过 B 树维护的。可对指定索引进行空间整理，重组数据，达到优化该表的目的。具体操作如下，以 test 为例介绍：</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">--- 首先查看 TEST 表的索引名</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">select</span> name <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> pid<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">select</span> id <span class="token keyword">from</span> sysobjects <span class="token keyword">where</span> name<span class="token operator">=</span><span class="token string">'TEST'</span> <span class="token operator">and</span> <span class="token keyword">type</span>$<span class="token operator">=</span><span class="token string">'SCHOBJ'</span><span class="token punctuation">)</span><span class="token operator">and</span> subtype$<span class="token operator">=</span><span class="token string">'INDEX'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">-- 结果</span></pre></td></tr><tr><td data-num="7"></td><td><pre>INDEX33568488</pre></td></tr><tr><td data-num="8"></td><td><pre>INDEX33568489</pre></td></tr><tr><td data-num="9"></td><td><pre>INDEX108643191852292</pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">--- 重组 TEST 表的索引</span></pre></td></tr><tr><td data-num="12"></td><td><pre>SP_REORGANIZE_INDEX<span class="token punctuation">(</span><span class="token string">'SYSDBA'</span><span class="token punctuation">,</span><span class="token string">'INDEX33568488'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="18"><li>如何开启结果集缓存</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 开启结果集缓存策略，可大大提升 sql 执行时间，达梦数据库如何开启结果集缓存</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>修改 dm<span class="token punctuation">.</span>ini 参数；</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>vim <span class="token operator">/</span>dmdata<span class="token operator">/</span>DAMENG<span class="token operator">/</span>dm<span class="token punctuation">.</span>ini</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">## 设置参数值，开启结果集缓存</span></pre></td></tr><tr><td data-num="9"></td><td><pre>RS_CAN_CACHE<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre>BUILD_FORWARD_RS<span class="token operator">=</span><span class="token number">1</span></pre></td></tr><tr><td data-num="11"></td><td><pre>RS_CACHE_TABLES<span class="token operator">=</span>HGTEST<span class="token punctuation">.</span>YBCK_CBEC_ELIST_ITEM<span class="token punctuation">,</span>HGTEST<span class="token punctuation">.</span>YBCK_CBEC_ELIST</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>当 RS_CAN_CACHE 为 <span class="token number">1</span> 时，还可以通过设置 INI 参数 RS_CACHE_TABLES 和 RS_CACHE_MIN_TIME 对缓存的结果集进行限制和过滤。RS_CACHE_TABLES 指定可以缓存结果集的基表清单，只有查询涉及的所有基表全部在参数指定范围内，此查询才会缓存结果集。RS_CACHE_MIN_TIME 则指定了缓存结果集的查询语句执行时间的下限，只有实际执行时间不少于指定值的查询结果集才会缓存。</pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>参数详情可以查看下方表格’参数说明‘</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>验证 dm<span class="token punctuation">.</span>ini 修改是否正确；</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> v$dm_ini <span class="token keyword">where</span> PARA_NAME <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'RS_CAN_CACHE'</span><span class="token punctuation">,</span><span class="token string">'BUILD_FORWARD_RS'</span><span class="token punctuation">,</span><span class="token string">'RS_CACHE_TABLES'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>重启数据库生效。</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>验证结果集缓存发现第一次查询慢 第二次查询就会快</pre></td></tr></table></figure><p>参数说明：</p><table><thead><tr><th>参数名</th><th>默认值</th><th>说明</th><th>属性</th></tr></thead><tbody><tr><td>RS_CAN_CACHE</td><td>0</td><td>结果集缓存配置。 0：禁止重用结果集； 1：强制模式，此时默认缓存所有结果集， 但可通过 RS_CACHE_TABLES 参数和语句 HINT 进行手动设置； 2：手动模式，此时默认不缓存结果集， 但可通过语句 HINT 对必要的结果集进行 缓存</td><td>静态</td></tr><tr><td>BUILD_FORWARD_RS</td><td>0</td><td>仅向前游标是否生成结果集。 0：不生成； 1：生成</td><td>静态</td></tr><tr><td>RS_CACHE_TABLES</td><td>空串</td><td>指定可以缓存结果集的基表的清单， 当 RS_CAN_CACHE=1 时，只有查 询涉及的所有基表全部在此参数指 定范围内，该查询才会缓存结果集。 当参数值为空串时，此参数失效。</td><td>手动</td></tr><tr><td>RS_CACHE_MIN_TIME</td><td></td><td>结果集缓存的语句执行时间下限，只 有实际执行时间不少于指定时间值的 查询，其结果集才会被缓存，仅在 RS_CAN_CACHE=1 时有效。默认值 0， 表示不限制；有效值范围（0~4294967294） ，以 MS 为单位。</td><td>动态，系统级</td></tr></tbody></table><ol start="19"><li>如何使用 DBMS_SQLTUNE 包获取 SQL 执行信息</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre>DBMS_SQLTUNE 包提供一系列对实时 <span class="token keyword">SQL</span> 监控的方法。当 <span class="token keyword">SQL</span> 监控功能开启后，DBMS_SQLTUNE 包可以实时监控 <span class="token keyword">SQL</span> 执行过程中的信息，包括：执行时间、执行代价、执行用户、统计信息等情况。<span class="token keyword">SQL</span> 监控功能开启的方法是将 DM<span class="token punctuation">.</span>INI 参数 ENABLE_MONITOR 和 MONITOR_SQL_EXEC 均设置为 <span class="token number">1</span>。</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>示例：</pre></td></tr><tr><td data-num="4"></td><td><pre>sp_set_para_value<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'ENABLE_MONITOR'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>sf_set_session_para_value<span class="token punctuation">(</span><span class="token string">'MONITOR_SQL_EXEC'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>需要优化的<span class="token keyword">sql</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> tablename<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>通过消息可以查询到执行号，我这里是<span class="token number">97828</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>调用DBMS_SQLTUNE函数传入执行号：</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">select</span> DBMS_SQLTUNE<span class="token punctuation">.</span>REPORT_SQL_MONITOR<span class="token punctuation">(</span>SQL_EXEC_ID<span class="token operator">=</span><span class="token operator">></span><span class="token number">97828</span><span class="token punctuation">)</span> <span class="token keyword">from</span> dual<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>下面是执行打印的结果：</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">SQL</span> Monitoring Report</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">SQL</span> <span class="token keyword">Text</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">------------------------------</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> zcjy_tdnz<span class="token punctuation">.</span>ht_land</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">Global</span> Information</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">------------------------------</span></pre></td></tr><tr><td data-num="24"></td><td><pre> <span class="token keyword">Status</span>                                 :  DONE <span class="token punctuation">(</span><span class="token keyword">ALL</span> <span class="token keyword">ROWS</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre> <span class="token keyword">Session</span>                                :  SYSDBA <span class="token punctuation">(</span><span class="token number">140599657854928</span>:<span class="token number">1260</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre> <span class="token keyword">SQL</span> ID                                 :  <span class="token number">13090</span></pre></td></tr><tr><td data-num="27"></td><td><pre> <span class="token keyword">SQL</span> Execution ID                       :  <span class="token number">97828</span></pre></td></tr><tr><td data-num="28"></td><td><pre> Execution Started                      :  <span class="token number">2024</span><span class="token operator">-</span><span class="token number">04</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">20</span>:<span class="token number">43</span>:<span class="token number">09</span></pre></td></tr><tr><td data-num="29"></td><td><pre> Duration                               :  <span class="token number">0.155809</span>s</pre></td></tr><tr><td data-num="30"></td><td><pre> Program                                :  manager<span class="token punctuation">.</span>exe</pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">Global</span> Stats</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token operator">|</span> Affected <span class="token operator">|</span>  Bytes   <span class="token operator">|</span> Bytes <span class="token operator">|</span>  Physical  <span class="token operator">|</span>  Logical   <span class="token operator">|</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token operator">|</span>   <span class="token keyword">Rows</span>   <span class="token operator">|</span> Allocate <span class="token operator">|</span> Free  <span class="token operator">|</span> <span class="token keyword">Read</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">Read</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token operator">|</span>      <span class="token number">100</span> <span class="token operator">|</span>        <span class="token number">0</span> <span class="token operator">|</span>     <span class="token number">0</span> <span class="token operator">|</span>        <span class="token number">100</span> <span class="token operator">|</span>         <span class="token number">20</span> <span class="token operator">|</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span><span class="token operator">=</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token keyword">SQL</span> <span class="token keyword">Plan</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token comment">------------------------------</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token number">1</span>   <span class="token comment">#NSET2: [529, 285219, 5845] </span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token number">2</span>     <span class="token comment">#PRJT2: [529, 285219, 5845]; exp_num(161), is_atom(FALSE) </span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token number">3</span>       <span class="token comment">#CSCN2: [529, 285219, 5845]; INDEX33580258(HT_LAND)</span></pre></td></tr></table></figure><ol start="20"><li>语句备份表</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 创建一个表结构与 table2 一模一样的表，只复制结构不复制数据；</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> table1 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table2 <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 创建一个表结构与 table2 一模一样的表，复制结构同时也复制数据；</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> table1 <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table2 <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">-- 创建一个表结构与 table2 一模一样的表，复制结构同时也复制数据，但是指定新表的列名</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">create</span> <span class="token keyword">table</span> table1<span class="token punctuation">(</span>新列名<span class="token number">1</span><span class="token punctuation">,</span>新列名<span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token keyword">select</span> 原列名<span class="token number">1</span><span class="token punctuation">,</span>原列名<span class="token number">2</span> <span class="token keyword">from</span> table2<span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="21"><li>修改表信息</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 修改表字段类型</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">ADD</span> <span class="token keyword">COLUMN</span> 字段名称 字段类型</pre></td></tr></table></figure><p>​</p><ol start="22"><li>确定高负载的 SQL</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 在打开监控开关（ENABLE_MONITOR=1、MONITOR_TIME=1）后</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#显示最近 1000 条执行时间较长的 SQL 语句</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> V$SYSTEM_LONG_EXEC_SQLS</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#显示服务器启动以来执行时间最长的 20 条 SQL 语句</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> V$LONG_EXEC_SQLS</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">-- 查看完整的 sql 语句</span></pre></td></tr><tr><td data-num="10"></td><td><pre>sf_get_session_sql<span class="token punctuation">(</span>sess_id<span class="token punctuation">)</span></pre></td></tr></table></figure><ol start="23"><li>查询函数和存储过程中的执行计划</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 执行命令查询执行的函数</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">select</span> cache_item<span class="token punctuation">,</span>sqlstr <span class="token keyword">from</span> v$cachepln <span class="token keyword">where</span> sqlstr <span class="token operator">like</span> <span class="token string">'%functionname%'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 生成执行计划的文件 在 /data/DAMENG/trace/ 目录下</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">SESSION</span> <span class="token keyword">SET</span> EVENTS <span class="token string">'IMMEDIATE TRACE NAME PLNDUMP,LEVEL 140015356688432'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">-- 打开文件后看见有另一个 cache_item  在重复执行命如：</span></pre></td></tr><tr><td data-num="8"></td><td><pre>sub_method<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> :: PLN<span class="token punctuation">[</span><span class="token number">140163083606064</span><span class="token punctuation">]</span><span class="token punctuation">[</span>PTEST1<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">ALTER</span> <span class="token keyword">SESSION</span> <span class="token keyword">SET</span> EVENTS <span class="token string">'IMMEDIATE TRACE NAME PLNDUMP,LEVEL 140163083606064'</span><span class="token punctuation">;</span></pre></td></tr></table></figure><ol start="24"><li>当 in 查询一个集合 闯入的是字符串的时候</li></ol><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 当需要 in 一个字符串集合</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> a <span class="token keyword">where</span> name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token string">'a,b,c,d'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 下面语句可以根据某个字符做匹配返回一个结果集</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">(</span><span class="token keyword">select</span> regexp_substr<span class="token punctuation">(</span><span class="token string">'jcd12,jcd13,jcd14'</span><span class="token punctuation">,</span><span class="token string">'[^,]+'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">level</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tempcol <span class="token keyword">from</span> dual <span class="token keyword">connect</span> <span class="token keyword">by</span> <span class="token keyword">level</span> <span class="token operator">&lt;=</span> LENGTH<span class="token punctuation">(</span>TRANSLATE<span class="token punctuation">(</span><span class="token string">'jcd12,jcd13,jcd14'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token operator">||</span><span class="token string">'jcd12,jcd13,jcd14'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">-- 上面查询的语句就可以写成</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> a <span class="token keyword">where</span> name <span class="token operator">in</span> <span class="token punctuation">(</span><span class="token keyword">select</span> regexp_substr<span class="token punctuation">(</span><span class="token string">'a,b,c,d'</span><span class="token punctuation">,</span><span class="token string">'[^,]+'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">level</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tempcol <span class="token keyword">from</span> dual <span class="token keyword">connect</span> <span class="token keyword">by</span> <span class="token keyword">level</span> <span class="token operator">&lt;=</span> LENGTH<span class="token punctuation">(</span>TRANSLATE<span class="token punctuation">(</span><span class="token string">'a,b,c,d'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token operator">||</span><span class="token string">'a,b,c,d'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="优化经验"><a class="anchor" href="#优化经验">#</a> 优化经验</h2><ol><li><p>如果服务器的 cpu 核心数足够大，可以设置并行度查询</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">-- 查询达梦并行度查询设置 如果为 2 则需要手动设置并行大小 不给默认就是串行</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">select</span> para_name<span class="token punctuation">,</span>para_value <span class="token keyword">from</span> v$dm_ini <span class="token keyword">where</span> para_name<span class="token operator">=</span><span class="token string">'PARALLEL_POLICY'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">-- 设置并行度查询：</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">select</span> <span class="token comment">/*+ PARALLEL(6) */</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">table</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">-- 跟内核有关系 如何上面设置了 6 实际 cpu 内核只有 4 那么实际查询只有 4 并行度</span></pre></td></tr></table></figure></li><li></li></ol><div class="tags"><a href="/tzblog/tags/%E8%BE%BE%E6%A2%A6/" rel="tag"><i class="ic i-tag"></i> 达梦</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-04-23 00:44:24" itemprop="dateModified" datetime="2024-04-23T00:44:24+08:00">2024-04-23</time> </span><span id="2024/03/24/computer-science/databases/dm/" class="item leancloud_visitors" data-flag-title="达梦数据库" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/tzblog/images/wechatpay.png" alt="Tz 微信支付"><p>微信支付</p></div><div><img data-src="/tzblog/images/alipay.png" alt="Tz 支付宝"><p>支付宝</p></div><div><img data-src="/tzblog/images/paypal.png" alt="Tz 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Tz <i class="ic i-at"><em>@</em></i>一些记录</li><li class="link"><strong>本文链接：</strong> <a href="https://mytingting.gitee.io/tzblog/2024/03/24/computer-science/databases/dm/" title="达梦数据库">https://mytingting.gitee.io/tzblog/2024/03/24/computer-science/databases/dm/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/tzblog/2024/03/24/computer-science/databases/starrocks/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tzting.github.io&#x2F;images&#x2F;sky3.jpg" title="StarRocks数据库"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 数据库</span><h3>StarRocks数据库</h3></a></div><div class="item right"><a href="/tzblog/2024/03/24/computer-science/tool-install/sqlserver-install/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tzting.github.io&#x2F;images&#x2F;sky7.jpg" title="server数据库的安装与使用"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 工具安装与使用</span><h3>server数据库的安装与使用</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">达梦数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%BE%E6%A2%A6%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.</span> <span class="toc-text">达梦数据库常用命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E7%BB%8F%E9%AA%8C"><span class="toc-number">1.3.</span> <span class="toc-text">优化经验</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/tzblog/2024/03/24/computer-science/databases/mysql/" rel="bookmark" title="mysql数据库">mysql数据库</a></li><li class="active"><a href="/tzblog/2024/03/24/computer-science/databases/dm/" rel="bookmark" title="达梦数据库">达梦数据库</a></li><li><a href="/tzblog/2024/03/24/computer-science/databases/starrocks/" rel="bookmark" title="StarRocks数据库">StarRocks数据库</a></li><li><a href="/tzblog/2024/03/24/computer-science/databases/sqlserver/" rel="bookmark" title="sqlserver数据库">sqlserver数据库</a></li><li><a href="/tzblog/2024/04/20/computer-science/databases/sql-optimization/" rel="bookmark" title="通用sql优化">通用sql优化</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Tz" data-src="/tzblog/images/avatar.jpg"><p class="name" itemprop="name">Tz</p><div class="description" itemprop="description">君将自由, 我心亦然</div></div><nav class="state"><div class="item posts"><a href="/tzblog/archives/"><span class="count">34</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/tzblog/categories/"><span class="count">18</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tzblog/tags/"><span class="count">22</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL1R6VGluZw==" title="https:&#x2F;&#x2F;github.com&#x2F;TzTing"><i class="ic i-github"></i></span> <a href="/tzblog/2269472297@qq.com" title="2269472297@qq.com" class="item email"><i class="ic i-envelope"></i></a></div><ul class="menu"><li class="item"><a href="/tzblog/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/tzblog/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/tzblog/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/tzblog/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tzblog/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/tzblog/links/" rel="section"><i class="ic i-magic"></i>链接</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/tzblog/2024/03/24/computer-science/databases/starrocks/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/tzblog/2024/03/24/computer-science/tool-install/sqlserver-install/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/dsa/" title="分类于 数据结构与算法">数据结构与算法</a></div><span><a href="/tzblog/2023/06/24/computer-science/dsa/week-1/" title="数据结构">数据结构</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/framework/" title="分类于 框架">框架</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/framework/java-application/" title="分类于 java应用程序框架">java应用程序框架</a></div><span><a href="/tzblog/2024/03/24/computer-science/framework/java-application/springboot-1/" title="Spring Boot框架">Spring Boot框架</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/framework/" title="分类于 框架">框架</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/framework/big-data-processing/" title="分类于 大数据处理框架">大数据处理框架</a></div><span><a href="/tzblog/2024/03/24/computer-science/framework/big-data-processing/flink-1/" title="flink">flink</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/middleware/" title="分类于 中间件">中间件</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/middleware/message-queue/" title="分类于 消息队列">消息队列</a></div><span><a href="/tzblog/2024/03/24/computer-science/middleware/message-queue/rocketmq-1/" title="rocket消息队列">rocket消息队列</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/tool-install/" title="分类于 工具安装与使用">工具安装与使用</a></div><span><a href="/tzblog/2024/03/24/computer-science/tool-install/sqlserver-install/" title="server数据库的安装与使用">server数据库的安装与使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/framework/" title="分类于 框架">框架</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/framework/%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/" title="分类于 数据库版本控制">数据库版本控制</a></div><span><a href="/tzblog/2024/03/24/computer-science/framework/liquibase/liquibase-1/" title="数据库版本控制-liqiubase">数据库版本控制-liqiubase</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/tool-install/" title="分类于 工具安装与使用">工具安装与使用</a></div><span><a href="/tzblog/2024/03/24/computer-science/tool-install/jprofile-install/" title="jprofile-java性能监视工具">jprofile-java性能监视工具</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/databases/" title="分类于 数据库">数据库</a></div><span><a href="/tzblog/2024/04/20/computer-science/databases/sql-optimization/" title="通用sql优化">通用sql优化</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/framework/" title="分类于 框架">框架</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/framework/big-data-processing/" title="分类于 大数据处理框架">大数据处理框架</a></div><span><a href="/tzblog/2024/03/24/computer-science/framework/big-data-processing/dinky-1/" title="dinky">dinky</a></span></li><li class="item"><div class="breadcrumb"><a href="/tzblog/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/dsa/" title="分类于 数据结构与算法">数据结构与算法</a> <i class="ic i-angle-right"></i> <a href="/tzblog/categories/computer-science/dsa/topic/" title="分类于 每日一题">每日一题</a></div><span><a href="/tzblog/2024/03/19/computer-science/dsa/topic/2671/" title="每日一题-频率跟踪器">每日一题-频率跟踪器</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2023 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Tz @ Tz</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">184k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:48</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/03/24/computer-science/databases/dm/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/tzblog/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->